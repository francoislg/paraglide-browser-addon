# vite-plugin-paraglide-debug

A Vite plugin that injects debug metadata into ParaglideJS translation strings, allowing you to inspect which translation key was used to generate each string in your browser.

## Features

- üîç **Debug Mode Only** - Activated via `VITE_PARAGLIDE_BROWSER_DEBUG=true` environment variable
- üè∑Ô∏è **Metadata Injection** - Wraps translated strings with `<span data-i18n-key="..." data-i18n-params="...">`
- üöÄ **Zero Runtime Overhead** - Only active in development when explicitly enabled
- üîå **Framework Agnostic** - Works with any framework using ParaglideJS and Vite

## Installation

```bash
npm install vite-plugin-paraglide-debug
# or
pnpm add vite-plugin-paraglide-debug
# or
yarn add vite-plugin-paraglide-debug
```

## Usage

### 1. Add to Vite Config

```javascript
import { defineConfig } from 'vite';
import { paraglideVitePlugin } from '@inlang/paraglide-js';
import { paraglideBrowserDebugPlugin } from 'vite-plugin-paraglide-debug';

export default defineConfig({
  plugins: [
    // Official Paraglide plugin MUST come first
    paraglideVitePlugin({
      project: './project.inlang',
      outdir: './src/paraglide'
    }),
    // Debug plugin runs after
    paraglideBrowserDebugPlugin({
      outdir: './src/paraglide'
    })
  ]
});
```

### 2. Enable Debug Mode

Create a `.env` file:
```
VITE_PARAGLIDE_BROWSER_DEBUG=true
```

### 3. Update Your Code

When debug mode is active, you need to use `innerHTML` instead of `textContent` to render the metadata:

```javascript
// Detect debug mode
const isDebugMode = import.meta.env.VITE_PARAGLIDE_BROWSER_DEBUG === 'true';

// Helper function
function setContent(element, content) {
  if (isDebugMode) {
    element.innerHTML = content;
  } else {
    element.textContent = content;
  }
}

// Usage
import * as m from './paraglide/messages.js';
setContent(document.getElementById('welcome'), m.welcome());
```

## How It Works

When `VITE_PARAGLIDE_BROWSER_DEBUG=true`, the plugin transforms generated Paraglide message functions to wrap their output:

**Before (generated by Paraglide):**
```javascript
export function welcome() {
  return "Welcome to my app!";
}

export function greeting(params) {
  return `Hello, ${params.name}!`;
}
```

**After (transformed by debug plugin):**
```javascript
function __paraglideBrowserDebugWrap(text, key, params) {
  const hasParams = params && Object.keys(params).length > 0;
  const paramsAttr = hasParams ? ` data-i18n-params='${JSON.stringify(params)}'` : '';
  return `<span data-i18n-key="${key}"${paramsAttr}>${text}</span>`;
}

export function welcome() {
  return __paraglideBrowserDebugWrap("Welcome to my app!", "welcome", {});
}

export function greeting(params) {
  return __paraglideBrowserDebugWrap(`Hello, ${params.name}!`, "greeting", params);
}
```

## Inspecting in Browser

Once enabled, you can:

1. **Inspect Elements** - Right-click any translated text and inspect to see `data-i18n-key`
2. **Query in Console**:
   ```javascript
   // Find all elements with a specific key
   document.querySelectorAll('[data-i18n-key="welcome"]')

   // Get all translation keys on the page
   Array.from(document.querySelectorAll('[data-i18n-key]'))
     .map(el => el.dataset.i18nKey)
   ```

## Options

```typescript
interface PluginOptions {
  outdir?: string; // Path where Paraglide generates files (default: './src/paraglide')
}
```

## Important Notes

‚ö†Ô∏è **Order Matters** - This plugin must come AFTER the official `paraglideVitePlugin`

‚ö†Ô∏è **Production Safety** - Never enable `VITE_PARAGLIDE_BROWSER_DEBUG` in production builds

‚ö†Ô∏è **Use innerHTML** - Debug metadata only works when rendering with `innerHTML`, not `textContent`

## License

MIT
